import puppeteer from 'puppeteer';
import { promises as fs } from 'fs';

(async () => {
  const browser = await puppeteer.launch({
    headless: false,
    userDataDir: './user_data',
  });
  const page = await browser.newPage();

  // const cookie = '[{"domain":"creativecloud.adobe.com","expires":1671039139000,"name":"aam_uuid","path":"/","sameSite":"lax","secure":false,"value":"18664222449099262354261549830816497988"},{"domain":"adobe.com","expires":1705049631051,"name":"s_ecid","path":"/","sameSite":"lax","secure":false,"value":"MCMID%7C79864449216731673351409121382713854915"},{"domain":"adobe.com","expires":1705049631051,"name":"s_vi","path":"/","sameSite":"lax","secure":false,"value":"[CS]v1|30AEA1328F39BBA1-40001F6675631337[CE]"},{"domain":"adobe.com","expires":1703150557459,"name":"AMCV_C74F69D7594880280A495D09%40AdobeOrg","path":"/","sameSite":"lax","secure":false,"value":"1176715910%7CMCMID%7C79864449216731673351409121382713854915%7CMCIDTS%7C19313%7CMCAAMLH-1669195357%7C6%7CMCAAMB-1669195357%7Cj8Odv6LonN4r3an7LhD3WZrU1bUpAkFkkiY1ncBR96t2PTI%7CMCOPTOUT-1668597757s%7CNONE%7CvVersion%7C5.4.0"},{"domain":"adobe.com","expires":1671609302000,"name":"feds_visitor_id","path":"/","sameSite":"lax","secure":false,"value":"mT44btWB-i6bykNCi3JIP"},{"domain":"adobe.com","expires":1671609302000,"name":"feds_visitor_audience","path":"/","sameSite":"lax","secure":false,"value":"%7B%22visitor%22%3A%22mT44btWB-i6bykNCi3JIP%22%2C%22cohort%22%3Atrue%7D"},{"domain":"adobe.com","expires":1701185545000,"name":"OptanonAlertBoxClosed","path":"/","sameSite":"lax","secure":false,"value":"2023-11-28T15:32:25.957Z"},{"domain":"adobe.com","expires":1685201546082,"name":"kndctr_9E1005A551ED61CA0A490D45_AdobeOrg_consent","path":"/","sameSite":"none","secure":true,"value":"general%3Din"},{"domain":"adobe.com","expires":1677425549000,"name":"_gcl_au","path":"/","sameSite":"lax","secure":false,"value":"1.1.1203539418.1669649549"},{"domain":"adobe.com","expires":1678265624000,"name":"_fbp","path":"/","sameSite":"lax","secure":false,"value":"fb.1.1669649549307.548428238"},{"domain":"adobe.com","expires":1703813549000,"name":"_cs_c","path":"/","sameSite":"lax","secure":false,"value":"0"},{"domain":"adobe.com","expires":1705047862194,"name":"_mkto_trk","path":"/","sameSite":"lax","secure":false,"value":"id:360-KCI-804&token:_mch-adobe.com-1669649549820-33984"},{"domain":"adobe.com","expires":1704185624000,"name":"_tt_enable_cookie","path":"/","sameSite":"lax","secure":false,"value":"1"},{"domain":"adobe.com","expires":1704185624000,"name":"_ttp","path":"/","sameSite":"lax","secure":false,"value":"df32df6c-3dc5-481d-8bba-41769ed98b61"},{"domain":"adobe.com","expires":1704364924100,"name":"id_adcloud","path":"/","sameSite":"lax","secure":false,"value":"YLicWwAAAHgKHx0T"},{"domain":"adobe.com","expires":1702025622000,"name":"OptanonChoice","path":"/","sameSite":"lax","secure":false,"value":"1"},{"domain":"adobe.com","expires":1703998646000,"name":"_scid","path":"/","sameSite":"lax","secure":false,"value":"cc5f0145-f744-40da-b77a-8893f8dcc02b"},{"domain":"adobe.com","expires":1672403948000,"name":"aam_uuid","path":"/","sameSite":"lax","secure":false,"value":"37835852547321559624333780024683979761"},{"domain":"adobe.com","expires":1703952322000,"name":"feds_privacy_consent","path":"/","sameSite":"lax","secure":false,"value":"{\\"hasUserProvidedConsent\\":true,\\"userHasCustomConsent\\":false}"},{"domain":"adobe.com","expires":1673015334000,"name":"fltk","path":"/","sameSite":"lax","secure":false,"value":"segID%3D13330890"},{"domain":"adobe.com","expires":1670931085000,"name":"event-origin","path":"/","sameSite":"lax","secure":true,"value":"https%3A%2F%2Fwww.adobe.com%2Fmax%2F2021%2Fsessions%2Fcreative-and-easy-photo-editing-withphotoshop-expr-s503.html"},{"domain":"adobe.com","expires":null,"name":"AMCVS_9E1005A551ED61CA0A490D45%40AdobeOrg","path":"/","sameSite":"lax","secure":false,"value":"1"},{"domain":"adobe.com","expires":null,"name":"s_cc","path":"/","sameSite":"lax","secure":false,"value":"true"},{"domain":"adobe.com","expires":null,"name":"at_check","path":"/","sameSite":"lax","secure":false,"value":"true"},{"domain":"adobe.com","expires":null,"name":"s_dmdbase","path":"/","sameSite":"lax","secure":false,"value":"1"},{"domain":"adobe.com","expires":1673015322000,"name":"s_iid","path":"/","sameSite":"lax","secure":true,"value":"70114000002XYvIAAW"},{"domain":"adobe.com","expires":null,"name":"_cs_cvars","path":"/","sameSite":"lax","secure":false,"value":"%7B%221%22%3A%5B%22Page%20Name%22%2C%22business.adobe.com%22%5D%7D"},{"domain":"adobe.com","expires":1704551338680,"name":"kndctr_9E1005A551ED61CA0A490D45_AdobeOrg_identity","path":"/","sameSite":"none","secure":true,"value":"CiY3OTg2NDQ0OTIxNjczMTY3MzM1MTQwOTEyMTM4MjcxMzg1NDkxNVIPCJzru8nJMBgBKgRJUkwx8AG8vfXnzjA%3D"},{"domain":"adobe.com","expires":null,"name":"dxHit","path":"/","sameSite":"lax","secure":false,"value":"3"},{"domain":"adobe.com","expires":null,"name":"AMCVS_D6FAAFAD54CA9F560A4C98A5%40AdobeOrg","path":"/","sameSite":"lax","secure":false,"value":"1"},{"domain":"creativecloud.adobe.com","expires":1670525424000,"name":"ln_or","path":"/","sameSite":"lax","secure":false,"value":"d"},{"domain":"adobe.com","expires":null,"name":"creative-cloud-theme","path":"/","sameSite":"none","secure":true,"value":"light"},{"domain":"adobe.com","expires":1680857622000,"name":"TID","path":"/","sameSite":"lax","secure":false,"value":"KZ6STZ7P--QGMZPG6T"},{"domain":"adobe.com","expires":1670494841445,"name":"bm_mi","path":"/","sameSite":"lax","secure":true,"value":"A74A82F5EAECD16A87BF61DB81C45EC5~YAAQM1tDUD4TCnmEAQAAe5HS8BIPp7qPOXRoFCR4ex9sSp0mXBYhfNhEbQrjiq4cH/QTMA8U9xMxaJ/ON/RW5/4DDiJQno74lPQ6JL45rWOhgTvkVXSqXmwny8/lJr2mmt/QABfpFOGvXL+/uXnQVJvD228dW7LN62kCj9bEEGzJGm15ZywpuTP0FhEMsRPKuRUxYW4fbSPxxwX3xguQzDjDh5u4p3FoE3/qSpEcHaJQMzbEhD9qCUJ4idq9GGsa47uslhdQCpAC7d4WVGG6K6v9+QKZ0DLvKkdyCWGgidewoBEph/8OFFUOOv0lxQvmIZrqnVI0UP9zvyvzWYgfg6OZO26q3g8sV7KGZz+I~1"},{"domain":"adobe.com","expires":1702023861000,"name":"OptanonConsent","path":"/","sameSite":"lax","secure":false,"value":"groups=C0001%3A1%2CC0002%3A1%2CC0003%3A1%2CC0004%3A1&geolocation=FR%3BGES&datestamp=Thu+Dec+08+2022+09%3A24%3A21+GMT%2B0100+(Central+European+Standard+Time)&version=6.9.0&isIABGlobal=false&hosts=&consentId=9d1320e2-3d1d-4625-a5fe-20039fd76273&interactionCount=0&landingPath=NotLandingPage&AwaitingReconsent=false"},{"domain":"adobe.com","expires":1702828287000,"name":"_cs_id","path":"/","sameSite":"lax","secure":false,"value":"d10cf010-e8c2-a206-d831-c077568b779d.1668664287.13.1670487862.1670487657.1.1702828287890"},{"domain":"creativecloud.adobe.com","expires":1670493191233,"name":"cc-aux-sid","path":"/","sameSite":"none","secure":true,"value":"true"},{"domain":"adobe.com","expires":1670491423000,"name":"s_vs","path":"/","sameSite":"lax","secure":false,"value":"1"},{"domain":null,"expires":null,"name":"cchome-loggedIn","path":"/","sameSite":"lax","secure":false,"value":"BEFE10425489D54F0A4C98A4@adobe.com"},{"domain":"adobe.com","expires":null,"name":"creative-cloud-referrer","path":"/","sameSite":"none","secure":true,"value":"https://adobeid-na1.services.adobe.com/"},{"domain":"adobe.com","expires":1702025622000,"name":"s_nr","path":"/","sameSite":"lax","secure":false,"value":"1670489622601-Repeat"},{"domain":"adobe.com","expires":1670491423000,"name":"gpv","path":"/","sameSite":"lax","secure":false,"value":"helpx.adobe.com:photoshop:tutorials"},{"domain":"adobe.com","expires":null,"name":"s_sq","path":"/","sameSite":"lax","secure":false,"value":"%5B%5BB%5D%5D"},{"domain":"adobe.com","expires":1670576023413,"name":"fg","path":"/","sameSite":"none","secure":true,"value":"XAJLLHR3XPE7IXWKGOQ52XYAOM======"},{"domain":"adobe.com","expires":1705049624094,"name":"adcloud","path":"/","sameSite":"lax","secure":false,"value":"{%22_les_v%22:%22y%2Cadobe.com%2C1670491424%22}"},{"domain":"adobe.com","expires":1670576024000,"name":"_uetsid","path":"/","sameSite":"lax","secure":false,"value":"7524d3d0763b11edacb163596b21c1f5"},{"domain":"adobe.com","expires":1704185624000,"name":"_uetvid","path":"/","sameSite":"lax","secure":false,"value":"119a14b0c1db11eba312bd645a7c09bd"},{"domain":"adobe.com","expires":1705049624386,"name":"AMCV_D6FAAFAD54CA9F560A4C98A5%40AdobeOrg","path":"/","sameSite":"lax","secure":false,"value":"-2121179033%7CMCMID%7C79864449216731673351409121382713854915%7CMCIDTS%7C19334%7CMCAAMLH-1671094424%7C6%7CMCAAMB-1671094424%7Cj8Odv6LonN4r3an7LhD3WZrU1bUpAkFkkiY1ncBR96t2PTI%7CMCOPTOUT-1670496824s%7CNONE%7CvVersion%7C5.3.0"},{"domain":"adobe.com","expires":1670494842837,"name":"bm_sv","path":"/","sameSite":"lax","secure":true,"value":"F90A0C0FB6A57829672E07B0C162F9FB~YAAQR/ZPF6+rvtOEAQAAN9Hw8BIpEvphagSQWJ7EnXhKJxVGTspeGrpF1Iw+73ZT/kYh56dgT3sceGaKRToUPZU1TramPagOgwrq15aQvkWdysfHuh9xYXQ1IlYOB4IWWtiKARGFYWlRJ0BAb4IcNnlh0YYEgAj0BJcswXBiEhvNqLFrcKfyCiZJYmZoZ/HODfiyuSgOd8vmho7iE1+oaAswvGRCRtf6IuR0mDK9E64PTy44LupfjziGlD1geQAU~1"},{"domain":"adobe.com","expires":1705049625544,"name":"mbox","path":"/","sameSite":"lax","secure":false,"value":"PC#e0914825b8004782806b08dd8064e4e0.37_0#1733734426|session#a6f8a10aa3e24326860b4c706a026d56#1670491486"},{"domain":"adobe.com","expires":1705049625648,"name":"AMCV_9E1005A551ED61CA0A490D45%40AdobeOrg","path":"/","sameSite":"none","secure":true,"value":"-2121179033%7CMCMID%7C79864449216731673351409121382713854915%7CMCAID%7C30AEA1328F39BBA1-40001F6675631337%7CMCIDTS%7C19335%7CMCAAMLH-1671094425%7C6%7CMCAAMB-1671094425%7Cj8Odv6LonN4r3an7LhD3WZrU1bUpAkFkkiY1ncBR96t2PTI%7CMCOPTOUT-1670496825s%7Cpartner%7CvVersion%7C5.3.0%7CMCCIDH%7C-2079240784"},{"domain":"adobe.com","expires":null,"name":"s_ppv","path":"/","sameSite":"lax","secure":false,"value":"[%22helpx.adobe.com/photoshop/tutorials.html%22%2C12%2C0%2C1064%2C1920%2C1064%2C1920%2C1200%2C1%2C%22P%22]"},{"domain":"adobe.com","expires":1670491717000,"name":"_cs_mk_aa","path":"/","sameSite":"none","secure":true,"value":"0.2619906029666683_1670489917937"}]';
  // const cookies = JSON.parse(cookie);
  // for (let i = 0; i < cookies.length; i++) {
  //   const c = cookies[i];
  //   if (c.domain) {
  //     c.expires = Math.floor(Date.now() / 1000) + 60 * 60 * 24 * 365;
  //     console.log(`${i} / ${cookies.length}`);
  //     console.log(c);
  //     await page.setCookie(c);
  //   }
  // }

  await page.goto('https://creativecloud.adobe.com/apps/all/desktop/pdp/photoshop', { timeout: 3000000 });

  await page.waitForTimeout(10000);

  await page.waitForSelector('.pdp-platform-agnostic-layout-resources', { timeout: 3000000 });

  const html = await page.evaluate(() => document.documentElement.outerHTML);
  console.log('html', html);

  await fs.writeFile('./output/photoshop.html', html);
  
  // await browser.close();
})();